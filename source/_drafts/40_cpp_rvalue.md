---
title: "C++ 右值引用"
date: 2023-08-29 18:20:41
description: 1
hide: true
categories: 
- Code
tags:
- Code
---



# 左值和右值

所谓左值一般指一个指向特定内存的具有名称的值（具名对象），它有一个相对稳定的内存地址，并且有一段较长的生命周期。

右值是指不指向稳定内存地址的匿名值（不具名对象），通常生命周期很短。

基于这一特征，能取到内存地址的值为左值，否则为右值。



```c++
int x = 1;
int *p = &x++;  // 编译失败
int *p = &++x;  // 编译成功
```

`x++`是右值，因为编译器首先会生成一份`x`值的临时复制，然后对`x`递增，最后返回临时复制内容。

`++x`是左值，它是直接对`x`递增后马上返回其自身。



```c++
int x = 1;
int get_val() {
	return x;
}
int *p = &get_val();  // 编译失败
```

`get_val()`函数返回了一个全局变量`x`，很明显变量`x`是一个左值，但是它经过函数返回以后变成了一个右值，因为函数返回时编译器会返回`x`的临时复制。



```c++
int x = 1;
void set_val(int val) {
	x = val;
}
int main() {
  set_val(6);
}
```

`set_val()`函数接受一个参数并将参数的值赋值给全局变量`x`。在`main()`函数中实参`6`是一个右值，但是进入函数之后形参`val`却变成了一个左值，可以对`val`使用取地址符。



通常字面量是右值，但是字符串字面量除外。因为编译器会将字符串常量存储到程序的数据段中，程序加载时会为其开辟内存空间。可以使用`&`获取字符串常亮的内存地址。



# 左值引用

非常量左值引用的引用对象只能是左值。常量左值引用除了能引用左值，也可以引用右值。

```c++
int &x1 = 7;         // 编译错误
const int &x2 = 11;  // 编译成功
```



常量左值引用可以绑定右值是一条非常棒的特性，但是它也存在一个很大的缺点——常量性。一旦使用了常量左值引用，就无法在函数内修改该对象的内容（强制类型转换除外）。所以需要另外一个特性来帮助我们完成这项工作，它就是右值引用。



# 右值引用

```c++
class X {
 public:
  X() {
    std::clog << "X ctor\n";
  }
  
  X(const X&x) {
    std::clog << "X copy ctor\n";
  }
  
  ~X() {
    std::clog << "X dtor\n";
  }
  
  
}
```

